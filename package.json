const express = require("express");
const { default: makeWASocket, useMultiFileAuthState } = require("@whiskeysockets/baileys");
const qrcode = require("qrcode");

const app = express();
const port = process.env.PORT || 3000;

(async () => {
  const { state, saveCreds } = await useMultiFileAuthState("./session");
  const sock = makeWASocket({ auth: state });

  sock.ev.on("creds.update", saveCreds);

  // Generate QR saat login
  sock.ev.on("connection.update", async (update) => {
    const { qr, connection } = update;
    if (qr) {
      await qrcode.toFile("views/qr.png", qr);
      console.log("✅ QR siap discan!");
    }
    if (connection === "open") {
      console.log("✅ Bot berhasil login!");
    }
  });

  // Contoh bot balas otomatis
  sock.ev.on("messages.upsert", async (msg) => {
    const pesan = msg.messages[0];
    if (!pesan.key.fromMe && pesan.message?.conversation) {
      await sock.sendMessage(pesan.key.remoteJid, { text: "Halo! Bot aktif ✅" });
    }
  });
})();

//
